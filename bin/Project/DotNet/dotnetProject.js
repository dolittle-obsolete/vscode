'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.restore = restore;
exports.build = build;
exports.buildCurrent = buildCurrent;
exports.test = test;
exports.testDebug = testDebug;
exports.rerunTest = rerunTest;

var _globals = require('../../globals');

var _globals2 = _interopRequireDefault(_globals);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var vscode = _globals2.default.vscode;

var spawn = require('child_process').spawn;
var executablePath = require.resolve('./Build/dotnet');

/**
 * Add standard listeners to standard output and error
 * @param {import('child_process').ChildProcess} dotnet
 */
function addListenersToChildProcess(dotnet) {

    dotnet.stdout.on('data', function (data) {
        _globals2.default.dolittleProjectOutputChannel.appendLine(data.toString());
    });

    dotnet.stderr.on('data', function (data) {
        _globals2.default.dolittleProjectOutputChannel.appendLine(data.toString());
    });
}
/**
 * Performs a restore task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function restore(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Restoring dotnet project:');
    var dotnet = spawn('node', [executablePath, '/root:' + root, '/type:build', '/arguments:restore'], { cwd: fileDir });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
/**
 * Performs a build task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function build(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Building dotnet project:');
    var dotnet = spawn('node', [executablePath, '/root:' + root, '/type:build', '/arguments:(build --no-restore)'], { cwd: fileDir });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
/**
 * Performs a build current task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function buildCurrent(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Building current dotnet project:');
    var dotnet = spawn('node', [executablePath, '/type:build', '/ignoreRewriteFolder', '/root:' + root, '/arguments:(build --no-dependencies --no-restore)'], { cwd: fileDir });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
/**
 * Performs a test task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function test(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Running tests for dotnet project:');
    var dotnet = spawn('node', [executablePath, '/type:test', '/root:' + root, '/arguments:(test --no-build --no-restore)'], { cwd: fileDir });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
/**
 * Performs a test debug task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function testDebug(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Debugging tests for dotnet project:');
    var dotnet = spawn('node', [executablePath, '/type:test', '/root:' + root, '/forTests', '/arguments:(test --no-build --no-restore)'], { cwd: fileDir, env: { VSTEST_HOST_DEBUG: "1" } });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
/**
 * Performs a test rerun task
 * @param {string} root Root of the workspace
 * @param {string} fileDir The directory path of the currently highlighted file
 * @returns {import('child_process').ChildProcess} The spawned dotnet child process
 * @memberof dotnet
 */
function rerunTest(root, fileDir) {
    _globals2.default.dolittleProjectOutputChannel.appendLine('Reruns tests for dotnet project:');
    var dotnet = spawn('node', [executablePath, '/type:test', '/root:' + root, '/arguments:(test --no-build --no-restore)', '/rerun'], { cwd: fileDir });
    addListenersToChildProcess(dotnet);
    return dotnet;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1NvdXJjZS9Qcm9qZWN0L0RvdE5ldC9kb3RuZXRQcm9qZWN0LmpzIl0sIm5hbWVzIjpbInJlc3RvcmUiLCJidWlsZCIsImJ1aWxkQ3VycmVudCIsInRlc3QiLCJ0ZXN0RGVidWciLCJyZXJ1blRlc3QiLCJ2c2NvZGUiLCJnbG9iYWxzIiwic3Bhd24iLCJyZXF1aXJlIiwiZXhlY3V0YWJsZVBhdGgiLCJyZXNvbHZlIiwiYWRkTGlzdGVuZXJzVG9DaGlsZFByb2Nlc3MiLCJkb3RuZXQiLCJzdGRvdXQiLCJvbiIsImRhdGEiLCJkb2xpdHRsZVByb2plY3RPdXRwdXRDaGFubmVsIiwiYXBwZW5kTGluZSIsInRvU3RyaW5nIiwic3RkZXJyIiwicm9vdCIsImZpbGVEaXIiLCJjd2QiLCJlbnYiLCJWU1RFU1RfSE9TVF9ERUJVRyJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUE0QmdCQSxPLEdBQUFBLE87UUFvQkFDLEssR0FBQUEsSztRQW9CQUMsWSxHQUFBQSxZO1FBcUJBQyxJLEdBQUFBLEk7UUFvQkFDLFMsR0FBQUEsUztRQXFCQUMsUyxHQUFBQSxTOztBQWxJaEI7Ozs7OztBQUVBLElBQU1DLFNBQVNDLGtCQUFRRCxNQUF2Qjs7QUFFQSxJQUFNRSxRQUFRQyxRQUFRLGVBQVIsRUFBeUJELEtBQXZDO0FBQ0EsSUFBTUUsaUJBQWlCRCxRQUFRRSxPQUFSLENBQWdCLGdCQUFoQixDQUF2Qjs7QUFFQTs7OztBQUlBLFNBQVNDLDBCQUFULENBQW9DQyxNQUFwQyxFQUE0Qzs7QUFFeENBLFdBQU9DLE1BQVAsQ0FBY0MsRUFBZCxDQUFpQixNQUFqQixFQUF5QixVQUFDQyxJQUFELEVBQVU7QUFDL0JULDBCQUFRVSw0QkFBUixDQUFxQ0MsVUFBckMsQ0FBZ0RGLEtBQUtHLFFBQUwsRUFBaEQ7QUFDSCxLQUZEOztBQUlBTixXQUFPTyxNQUFQLENBQWNMLEVBQWQsQ0FBaUIsTUFBakIsRUFBeUIsVUFBQ0MsSUFBRCxFQUFVO0FBQy9CVCwwQkFBUVUsNEJBQVIsQ0FBcUNDLFVBQXJDLENBQWdERixLQUFLRyxRQUFMLEVBQWhEO0FBQ0gsS0FGRDtBQUdIO0FBQ0Q7Ozs7Ozs7QUFPTyxTQUFTbkIsT0FBVCxDQUFpQnFCLElBQWpCLEVBQXVCQyxPQUF2QixFQUFnQztBQUNuQ2Ysc0JBQVFVLDRCQUFSLENBQXFDQyxVQUFyQyxDQUFnRCwyQkFBaEQ7QUFDQSxRQUFJTCxTQUFTTCxNQUNULE1BRFMsRUFFVCxDQUFFRSxjQUFGLGFBQ2FXLElBRGIsRUFFSSxhQUZKLEVBR0ksb0JBSEosQ0FGUyxFQU9ULEVBQUNFLEtBQUtELE9BQU4sRUFQUyxDQUFiO0FBUUFWLCtCQUEyQkMsTUFBM0I7QUFDQSxXQUFPQSxNQUFQO0FBQ0g7QUFDRDs7Ozs7OztBQU9PLFNBQVNaLEtBQVQsQ0FBZW9CLElBQWYsRUFBcUJDLE9BQXJCLEVBQThCO0FBQ2pDZixzQkFBUVUsNEJBQVIsQ0FBcUNDLFVBQXJDLENBQWdELDBCQUFoRDtBQUNBLFFBQUlMLFNBQVNMLE1BQ1QsTUFEUyxFQUVULENBQUVFLGNBQUYsYUFDYVcsSUFEYixFQUVJLGFBRkosRUFHSSxpQ0FISixDQUZTLEVBT1QsRUFBQ0UsS0FBS0QsT0FBTixFQVBTLENBQWI7QUFRQVYsK0JBQTJCQyxNQUEzQjtBQUNBLFdBQU9BLE1BQVA7QUFDSDtBQUNEOzs7Ozs7O0FBT08sU0FBU1gsWUFBVCxDQUFzQm1CLElBQXRCLEVBQTRCQyxPQUE1QixFQUFxQztBQUN4Q2Ysc0JBQVFVLDRCQUFSLENBQXFDQyxVQUFyQyxDQUFnRCxrQ0FBaEQ7QUFDQSxRQUFJTCxTQUFTTCxNQUNULE1BRFMsRUFFVCxDQUFFRSxjQUFGLEVBQ0ksYUFESixFQUVJLHNCQUZKLGFBR2FXLElBSGIsRUFJSSxtREFKSixDQUZTLEVBUVQsRUFBQ0UsS0FBS0QsT0FBTixFQVJTLENBQWI7QUFTQVYsK0JBQTJCQyxNQUEzQjtBQUNBLFdBQU9BLE1BQVA7QUFDSDtBQUNEOzs7Ozs7O0FBT08sU0FBU1YsSUFBVCxDQUFja0IsSUFBZCxFQUFvQkMsT0FBcEIsRUFBNkI7QUFDaENmLHNCQUFRVSw0QkFBUixDQUFxQ0MsVUFBckMsQ0FBZ0QsbUNBQWhEO0FBQ0EsUUFBSUwsU0FBU0wsTUFDVCxNQURTLEVBRVQsQ0FBRUUsY0FBRixFQUNJLFlBREosYUFFYVcsSUFGYixFQUdJLDJDQUhKLENBRlMsRUFPVCxFQUFDRSxLQUFLRCxPQUFOLEVBUFMsQ0FBYjtBQVFBViwrQkFBMkJDLE1BQTNCO0FBQ0EsV0FBT0EsTUFBUDtBQUNIO0FBQ0Q7Ozs7Ozs7QUFPTyxTQUFTVCxTQUFULENBQW1CaUIsSUFBbkIsRUFBeUJDLE9BQXpCLEVBQWtDO0FBQ3JDZixzQkFBUVUsNEJBQVIsQ0FBcUNDLFVBQXJDLENBQWdELHFDQUFoRDtBQUNBLFFBQUlMLFNBQVNMLE1BQ1QsTUFEUyxFQUVULENBQUVFLGNBQUYsRUFDSSxZQURKLGFBRWFXLElBRmIsRUFHSSxXQUhKLEVBSUksMkNBSkosQ0FGUyxFQVFULEVBQUNFLEtBQUtELE9BQU4sRUFBZUUsS0FBSyxFQUFDQyxtQkFBbUIsR0FBcEIsRUFBcEIsRUFSUyxDQUFiO0FBU0FiLCtCQUEyQkMsTUFBM0I7QUFDQSxXQUFPQSxNQUFQO0FBQ0g7QUFDRDs7Ozs7OztBQU9PLFNBQVNSLFNBQVQsQ0FBbUJnQixJQUFuQixFQUF5QkMsT0FBekIsRUFBa0M7QUFDckNmLHNCQUFRVSw0QkFBUixDQUFxQ0MsVUFBckMsQ0FBZ0Qsa0NBQWhEO0FBQ0EsUUFBSUwsU0FBU0wsTUFDVCxNQURTLEVBRVQsQ0FBRUUsY0FBRixFQUNJLFlBREosYUFFYVcsSUFGYixFQUdJLDJDQUhKLEVBSUksUUFKSixDQUZTLEVBUVQsRUFBQ0UsS0FBS0QsT0FBTixFQVJTLENBQWI7QUFTQVYsK0JBQTJCQyxNQUEzQjtBQUNBLFdBQU9BLE1BQVA7QUFDSCIsImZpbGUiOiJkb3RuZXRQcm9qZWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGdsb2JhbHMgZnJvbSAnLi4vLi4vZ2xvYmFscyc7XG5cbmNvbnN0IHZzY29kZSA9IGdsb2JhbHMudnNjb2RlO1xuXG5jb25zdCBzcGF3biA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5zcGF3bjtcbmNvbnN0IGV4ZWN1dGFibGVQYXRoID0gcmVxdWlyZS5yZXNvbHZlKCcuL0J1aWxkL2RvdG5ldCcpO1xuXG4vKipcbiAqIEFkZCBzdGFuZGFyZCBsaXN0ZW5lcnMgdG8gc3RhbmRhcmQgb3V0cHV0IGFuZCBlcnJvclxuICogQHBhcmFtIHtpbXBvcnQoJ2NoaWxkX3Byb2Nlc3MnKS5DaGlsZFByb2Nlc3N9IGRvdG5ldFxuICovXG5mdW5jdGlvbiBhZGRMaXN0ZW5lcnNUb0NoaWxkUHJvY2Vzcyhkb3RuZXQpIHtcbiAgICBcbiAgICBkb3RuZXQuc3Rkb3V0Lm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgICAgZ2xvYmFscy5kb2xpdHRsZVByb2plY3RPdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoZGF0YS50b1N0cmluZygpKTtcbiAgICB9KTtcblxuICAgIGRvdG5ldC5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgICAgICBnbG9iYWxzLmRvbGl0dGxlUHJvamVjdE91dHB1dENoYW5uZWwuYXBwZW5kTGluZShkYXRhLnRvU3RyaW5nKCkpO1xuICAgIH0pO1xufVxuLyoqXG4gKiBQZXJmb3JtcyBhIHJlc3RvcmUgdGFza1xuICogQHBhcmFtIHtzdHJpbmd9IHJvb3QgUm9vdCBvZiB0aGUgd29ya3NwYWNlXG4gKiBAcGFyYW0ge3N0cmluZ30gZmlsZURpciBUaGUgZGlyZWN0b3J5IHBhdGggb2YgdGhlIGN1cnJlbnRseSBoaWdobGlnaHRlZCBmaWxlXG4gKiBAcmV0dXJucyB7aW1wb3J0KCdjaGlsZF9wcm9jZXNzJykuQ2hpbGRQcm9jZXNzfSBUaGUgc3Bhd25lZCBkb3RuZXQgY2hpbGQgcHJvY2Vzc1xuICogQG1lbWJlcm9mIGRvdG5ldFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzdG9yZShyb290LCBmaWxlRGlyKSB7XG4gICAgZ2xvYmFscy5kb2xpdHRsZVByb2plY3RPdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJ1Jlc3RvcmluZyBkb3RuZXQgcHJvamVjdDonKTtcbiAgICBsZXQgZG90bmV0ID0gc3Bhd24oXG4gICAgICAgICdub2RlJywgXG4gICAgICAgIFsgZXhlY3V0YWJsZVBhdGgsIFxuICAgICAgICAgICAgYC9yb290OiR7cm9vdH1gLCBcbiAgICAgICAgICAgICcvdHlwZTpidWlsZCcsIFxuICAgICAgICAgICAgJy9hcmd1bWVudHM6cmVzdG9yZSdcbiAgICAgICAgXSwgXG4gICAgICAgIHtjd2Q6IGZpbGVEaXJ9KTtcbiAgICBhZGRMaXN0ZW5lcnNUb0NoaWxkUHJvY2Vzcyhkb3RuZXQpO1xuICAgIHJldHVybiBkb3RuZXQ7XG59O1xuLyoqXG4gKiBQZXJmb3JtcyBhIGJ1aWxkIHRhc2tcbiAqIEBwYXJhbSB7c3RyaW5nfSByb290IFJvb3Qgb2YgdGhlIHdvcmtzcGFjZVxuICogQHBhcmFtIHtzdHJpbmd9IGZpbGVEaXIgVGhlIGRpcmVjdG9yeSBwYXRoIG9mIHRoZSBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgZmlsZVxuICogQHJldHVybnMge2ltcG9ydCgnY2hpbGRfcHJvY2VzcycpLkNoaWxkUHJvY2Vzc30gVGhlIHNwYXduZWQgZG90bmV0IGNoaWxkIHByb2Nlc3NcbiAqIEBtZW1iZXJvZiBkb3RuZXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkKHJvb3QsIGZpbGVEaXIpIHtcbiAgICBnbG9iYWxzLmRvbGl0dGxlUHJvamVjdE91dHB1dENoYW5uZWwuYXBwZW5kTGluZSgnQnVpbGRpbmcgZG90bmV0IHByb2plY3Q6Jyk7XG4gICAgbGV0IGRvdG5ldCA9IHNwYXduKFxuICAgICAgICAnbm9kZScsIFxuICAgICAgICBbIGV4ZWN1dGFibGVQYXRoLCBcbiAgICAgICAgICAgIGAvcm9vdDoke3Jvb3R9YCwgXG4gICAgICAgICAgICAnL3R5cGU6YnVpbGQnLCBcbiAgICAgICAgICAgICcvYXJndW1lbnRzOihidWlsZCAtLW5vLXJlc3RvcmUpJ1xuICAgICAgICBdLCBcbiAgICAgICAge2N3ZDogZmlsZURpcn0pO1xuICAgIGFkZExpc3RlbmVyc1RvQ2hpbGRQcm9jZXNzKGRvdG5ldCk7XG4gICAgcmV0dXJuIGRvdG5ldDtcbn07XG4vKipcbiAqIFBlcmZvcm1zIGEgYnVpbGQgY3VycmVudCB0YXNrXG4gKiBAcGFyYW0ge3N0cmluZ30gcm9vdCBSb290IG9mIHRoZSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlRGlyIFRoZSBkaXJlY3RvcnkgcGF0aCBvZiB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIGZpbGVcbiAqIEByZXR1cm5zIHtpbXBvcnQoJ2NoaWxkX3Byb2Nlc3MnKS5DaGlsZFByb2Nlc3N9IFRoZSBzcGF3bmVkIGRvdG5ldCBjaGlsZCBwcm9jZXNzXG4gKiBAbWVtYmVyb2YgZG90bmV0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZEN1cnJlbnQocm9vdCwgZmlsZURpcikge1xuICAgIGdsb2JhbHMuZG9saXR0bGVQcm9qZWN0T3V0cHV0Q2hhbm5lbC5hcHBlbmRMaW5lKCdCdWlsZGluZyBjdXJyZW50IGRvdG5ldCBwcm9qZWN0OicpO1xuICAgIGxldCBkb3RuZXQgPSBzcGF3bihcbiAgICAgICAgJ25vZGUnLCBcbiAgICAgICAgWyBleGVjdXRhYmxlUGF0aCwgXG4gICAgICAgICAgICAnL3R5cGU6YnVpbGQnLCBcbiAgICAgICAgICAgICcvaWdub3JlUmV3cml0ZUZvbGRlcicsXG4gICAgICAgICAgICBgL3Jvb3Q6JHtyb290fWAsXG4gICAgICAgICAgICAnL2FyZ3VtZW50czooYnVpbGQgLS1uby1kZXBlbmRlbmNpZXMgLS1uby1yZXN0b3JlKSdcbiAgICAgICAgXSwgXG4gICAgICAgIHtjd2Q6IGZpbGVEaXJ9KTtcbiAgICBhZGRMaXN0ZW5lcnNUb0NoaWxkUHJvY2Vzcyhkb3RuZXQpO1xuICAgIHJldHVybiBkb3RuZXQ7XG59O1xuLyoqXG4gKiBQZXJmb3JtcyBhIHRlc3QgdGFza1xuICogQHBhcmFtIHtzdHJpbmd9IHJvb3QgUm9vdCBvZiB0aGUgd29ya3NwYWNlXG4gKiBAcGFyYW0ge3N0cmluZ30gZmlsZURpciBUaGUgZGlyZWN0b3J5IHBhdGggb2YgdGhlIGN1cnJlbnRseSBoaWdobGlnaHRlZCBmaWxlXG4gKiBAcmV0dXJucyB7aW1wb3J0KCdjaGlsZF9wcm9jZXNzJykuQ2hpbGRQcm9jZXNzfSBUaGUgc3Bhd25lZCBkb3RuZXQgY2hpbGQgcHJvY2Vzc1xuICogQG1lbWJlcm9mIGRvdG5ldFxuICovXG5leHBvcnQgZnVuY3Rpb24gdGVzdChyb290LCBmaWxlRGlyKSB7XG4gICAgZ2xvYmFscy5kb2xpdHRsZVByb2plY3RPdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJ1J1bm5pbmcgdGVzdHMgZm9yIGRvdG5ldCBwcm9qZWN0OicpO1xuICAgIGxldCBkb3RuZXQgPSBzcGF3bihcbiAgICAgICAgJ25vZGUnLCBcbiAgICAgICAgWyBleGVjdXRhYmxlUGF0aCwgXG4gICAgICAgICAgICAnL3R5cGU6dGVzdCcsIFxuICAgICAgICAgICAgYC9yb290OiR7cm9vdH1gLFxuICAgICAgICAgICAgJy9hcmd1bWVudHM6KHRlc3QgLS1uby1idWlsZCAtLW5vLXJlc3RvcmUpJ1xuICAgICAgICBdLCBcbiAgICAgICAge2N3ZDogZmlsZURpcn0pO1xuICAgIGFkZExpc3RlbmVyc1RvQ2hpbGRQcm9jZXNzKGRvdG5ldCk7XG4gICAgcmV0dXJuIGRvdG5ldDtcbn07XG4vKipcbiAqIFBlcmZvcm1zIGEgdGVzdCBkZWJ1ZyB0YXNrXG4gKiBAcGFyYW0ge3N0cmluZ30gcm9vdCBSb290IG9mIHRoZSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlRGlyIFRoZSBkaXJlY3RvcnkgcGF0aCBvZiB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIGZpbGVcbiAqIEByZXR1cm5zIHtpbXBvcnQoJ2NoaWxkX3Byb2Nlc3MnKS5DaGlsZFByb2Nlc3N9IFRoZSBzcGF3bmVkIGRvdG5ldCBjaGlsZCBwcm9jZXNzXG4gKiBAbWVtYmVyb2YgZG90bmV0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0ZXN0RGVidWcocm9vdCwgZmlsZURpcikge1xuICAgIGdsb2JhbHMuZG9saXR0bGVQcm9qZWN0T3V0cHV0Q2hhbm5lbC5hcHBlbmRMaW5lKCdEZWJ1Z2dpbmcgdGVzdHMgZm9yIGRvdG5ldCBwcm9qZWN0OicpO1xuICAgIGxldCBkb3RuZXQgPSBzcGF3bihcbiAgICAgICAgJ25vZGUnLCBcbiAgICAgICAgWyBleGVjdXRhYmxlUGF0aCwgXG4gICAgICAgICAgICAnL3R5cGU6dGVzdCcsIFxuICAgICAgICAgICAgYC9yb290OiR7cm9vdH1gLFxuICAgICAgICAgICAgJy9mb3JUZXN0cycsXG4gICAgICAgICAgICAnL2FyZ3VtZW50czoodGVzdCAtLW5vLWJ1aWxkIC0tbm8tcmVzdG9yZSknXG4gICAgICAgIF0sIFxuICAgICAgICB7Y3dkOiBmaWxlRGlyLCBlbnY6IHtWU1RFU1RfSE9TVF9ERUJVRzogXCIxXCJ9fSk7XG4gICAgYWRkTGlzdGVuZXJzVG9DaGlsZFByb2Nlc3MoZG90bmV0KTtcbiAgICByZXR1cm4gZG90bmV0O1xufTtcbi8qKlxuICogUGVyZm9ybXMgYSB0ZXN0IHJlcnVuIHRhc2tcbiAqIEBwYXJhbSB7c3RyaW5nfSByb290IFJvb3Qgb2YgdGhlIHdvcmtzcGFjZVxuICogQHBhcmFtIHtzdHJpbmd9IGZpbGVEaXIgVGhlIGRpcmVjdG9yeSBwYXRoIG9mIHRoZSBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgZmlsZVxuICogQHJldHVybnMge2ltcG9ydCgnY2hpbGRfcHJvY2VzcycpLkNoaWxkUHJvY2Vzc30gVGhlIHNwYXduZWQgZG90bmV0IGNoaWxkIHByb2Nlc3NcbiAqIEBtZW1iZXJvZiBkb3RuZXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcnVuVGVzdChyb290LCBmaWxlRGlyKSB7XG4gICAgZ2xvYmFscy5kb2xpdHRsZVByb2plY3RPdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJ1JlcnVucyB0ZXN0cyBmb3IgZG90bmV0IHByb2plY3Q6Jyk7XG4gICAgbGV0IGRvdG5ldCA9IHNwYXduKFxuICAgICAgICAnbm9kZScsIFxuICAgICAgICBbIGV4ZWN1dGFibGVQYXRoLCBcbiAgICAgICAgICAgICcvdHlwZTp0ZXN0JywgXG4gICAgICAgICAgICBgL3Jvb3Q6JHtyb290fWAsXG4gICAgICAgICAgICAnL2FyZ3VtZW50czoodGVzdCAtLW5vLWJ1aWxkIC0tbm8tcmVzdG9yZSknLFxuICAgICAgICAgICAgJy9yZXJ1bidcbiAgICAgICAgXSwgXG4gICAgICAgIHtjd2Q6IGZpbGVEaXJ9KTtcbiAgICBhZGRMaXN0ZW5lcnNUb0NoaWxkUHJvY2Vzcyhkb3RuZXQpO1xuICAgIHJldHVybiBkb3RuZXQ7XG59OyJdfQ==